/* Minified (23.89%) © Copyright 2021 Martin Weiss (martinweiss.cz) */
const DEBUG=!1,overlayModalBox=document.getElementById("overlayModal"),modalContentBox=document.getElementById("modalContentBox"),modalConfirmInput=document.getElementById("modalConfirm"),modalCancelInput=document.getElementById("modalCancel"),loaderElement=document.getElementById("loader"),rlMenu=document.getElementById("restaurantsList").childNodes,restaurantsContentChildren=document.getElementsByClassName("sb");for(let a=0;a<rlMenu.length;a++)rlMenu[a].addEventListener("click",function(){loadContent(this)});document.addEventListener("DOMContentLoaded",showDashboard),document.getElementById("dashboardSwitcher").addEventListener("click",showDashboard);function loadContent(a){let b=a.dataset.restaurantId,c=document.getElementById("restaurantBodyID-"+b);for(let b=0;b<rlMenu.length;b++)rlMenu[b].classList.remove("active");a.classList.add("active");for(let b=0;b<restaurantsContentChildren.length;b++)restaurantsContentChildren[b].setAttribute("hidden","");document.getElementById("dashboardBody").setAttribute("hidden",""),loaderElement.removeAttribute("hidden"),c.hasAttribute("prepared")&&(getRestaurantFoodList(b),c.removeAttribute("prepared")),loaderElement.setAttribute("hidden",""),c.removeAttribute("hidden")}function addNewFood(a){let b=a.dataset.restaurantId;showModal("<h1>P\u0159idat nov\xE9 j\xEDdlo</h1><input id=\"insertFoodName\" placeholder=\"N\xE1zev j\xEDdla\"><input id=\"insertFoodPrice\" placeholder=\"Cena j\xEDdla\"><input id=\"insertImage\" type=\"file\" accept=\".jpeg, .jpg, .png, .webp, .avif\">",b,"P\u0159idat",1)}function getRestaurantFoodList(a){fetch("../controllers/getFoodList.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`rid=${a}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(b=>{if(b.error_code)console.warn(`[!] ${b.error_message} (code: ${b.error_code}) | ${b.mysql_error}`);else{let c=`<span>Toto je obsah restaurace s ID: ${a}</span><div data-restaurant-id="${a}" id="addNewFoodButton-${a}" onclick="addNewFood(this)">Přidat nové jídlo</div><div id="foodlistRestaurantID-${a}" class="foodlist">`;if(!b.emptylist)for(let a=0;a<b.length;a++)c+=`<div id="foodID-${b[a][0]}" data-fid="${b[a][0]}" class="food-record"><div class="foodInfo"><span id="foodName-${b[a][0]}" data-default="${b[a][1]}" class="foodName">${b[a][1]}</span><div class="foodPriceRow"><span id="foodPrice-${b[a][0]}" data-default="${b[a][2]}" class="foodPrice">${b[a][2]}</span><span> Kč</span></div></div><div class="row"><icon class="edit">edit</icon><icon class="delete" onclick="modalMode_Deleting(${b[a][0]})">delete_outline</icon></div></div>`;c+=`</div>`,document.getElementById("restaurantBodyID-"+a).innerHTML=c}}).catch(a=>{console.log(`[!][downloadingFoodList] ${a}`)})}function appendFoodToList(a,b,c,d){let e=document.createElement("div");e.setAttribute("id","foodID-"+b),e.setAttribute("data-fid",b),e.classList.add("food-record"),e.innerHTML=`<div id="foodID-${b}" data-fid="${b}" class="food-record"><div class="foodInfo"><span id="foodName-${b}" data-default="${c}" class="foodName">${c}</span><div class="foodPriceRow"><span id="foodPrice-${b}" data-default="${d}" class="foodPrice">${d}</span><span> Kč</span></div></div><div class="row"><icon class="edit">edit</icon><icon class="delete" onclick="modalMode_Deleting(${b})">delete_outline</icon></div></div>`,document.getElementById("foodlistRestaurantID-"+a).appendChild(e)}modalConfirmInput.addEventListener("click",function(){if(1==overlayModalBox.dataset.mode){let a=overlayModalBox.dataset.obj,b=document.getElementById("insertFoodName").value,c=document.getElementById("insertFoodPrice").value,d=document.getElementById("insertImage").files[0];if(""!=b&&""!=c&&d!==void 0&&1086e3>d.size){const e=new FormData;e.append("rid",a),e.append("foodname",b),e.append("foodprice",c),e.append("img",d),fetch("../controllers/addFood.php",{method:"POST",credentials:"same-origin",body:e}).then(a=>a.ok?a.json():Promise.reject(a)).then(d=>{d.error_code?console.warn(`[!] ${d.error_message} (code: ${d.error_code}) | ${d.mysql_error}`):appendFoodToList(a,d.insert_id,b,c)}).catch(a=>{console.log(`[!][overlayModalBox.mode ${overlayModalBox.dataset.mode}] ${a}`)})}else showToast("Chyba p\u0159i p\u0159id\xE1v\xE1n\xED nov\xE9ho j\xEDdla")}else if(2==overlayModalBox.dataset.mode){let a=document.getElementById("foodID-"+overlayModalBox.dataset.obj);DEBUG?deleteRecord(a):fetch("../controllers/removeFood.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`fid=${overlayModalBox.dataset.obj}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(b=>{b.error_code?console.warn(`[!] ${b.error_message} (code: ${b.error_code}) | ${b.mysql_error}`):!0==b.success?deleteRecord(a):console.log("[!] P\u0159i maz\xE1n\xED z\xE1znamu do\u0161lo k chyb\u011B")}).catch(a=>{console.log(`[!][overlayModalBox.mode ${overlayModalBox.dataset.mode}] ${a}`)})}hideModal()}),modalCancelInput.addEventListener("click",hideModal);function showDashboard(){for(let a=0;a<rlMenu.length;a++)rlMenu[a].classList.remove("active");document.getElementById("dashboardSwitcher").classList.add("active");for(let a=0;a<restaurantsContentChildren.length;a++)restaurantsContentChildren[a].setAttribute("hidden","");document.getElementById("loader").setAttribute("hidden",""),document.getElementById("dashboardBody").removeAttribute("hidden")}function modalMode_Deleting(a){let b="<h1>Smazat j\xEDdlo</h1>"+document.getElementById("foodName-"+a).innerText;showModal(b,a,"Potvrdit",2)}function deleteRecord(a){a.parentNode.removeChild(a)}function showModal(a,b,c,d){modalContentBox.innerHTML=a,modalConfirmInput.innerText=c,overlayModalBox.setAttribute("data-obj",b),overlayModalBox.setAttribute("data-mode",d),overlayModalBox.classList.add("active"),document.getElementsByClassName("container")[0].setAttribute("modon","")}function hideModal(){modalContentBox.innerHTML="",modalConfirmInput.innerHTML="",overlayModalBox.removeAttribute("data-obj"),overlayModalBox.removeAttribute("data-mode"),overlayModalBox.classList.remove("active"),document.getElementsByClassName("container")[0].removeAttribute("modon")}