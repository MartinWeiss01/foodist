const a=document.querySelectorAll("[lookup]"),currentPassword=document.getElementById("userCurrentPassword"),newPassword=document.getElementById("userNewPassword"),passwordMessage=document.getElementById("passwordChangeError"),emailMessage=document.getElementById("emailChangeError"),phoneMessage=document.getElementById("phoneChangeError"),updateprofile=document.getElementById("updateprofile"),profileImage=document.getElementById("profileImage"),uploadImage=document.getElementById("uploadImage"),uploadImageController=document.getElementById("uploadImageController"),deleteImageController=document.getElementById("deleteImageController"),showError=(a,b=!0,c=null)=>{a.style.display=["block","none"][+b],null!==c&&(b?c.dataset.state=!0:c.dataset.state=!1)},checkPassword=(a,b)=>""!==a.value&&""!==b.value&&a.value!==b.value,checkMail=a=>/^(.+)@(.+)\.(.+)$/g.test(a),checkPhone=a=>/^\+\d{3}\s(\d{3}){3}$/g.test(a),passwordCheck=()=>showError(passwordMessage,checkPassword(currentPassword,newPassword),newPassword),reloadProfile=b=>{if(!0===b.success){for(let b=0;b<a.length;b++)a[b].dataset.default!==a[b].value&&(a[b].dataset.default=a[b].value,a[b].dataset.state=!1);showToast("Zm\u011Bny byly \xFAsp\u011B\u0161n\u011B ulo\u017Eeny")}else!1===b.success&&showToast(b.fail)},disableImageControllers=(a,b=null)=>{uploadImageController.disabled=a,deleteImageController.disabled=a,null!==b&&showToast(b)},deleteImage=()=>{profileImage.src="/uploads/profiles/default.svg",disableImageControllers(!1,"Profilov\xFD obr\xE1zek byl odstran\u011Bn")},updateImage=a=>{profileImage.src=`/uploads/profiles/${a}`,disableImageControllers(!1,"Profilov\xFD obr\xE1zek byl zm\u011Bn\u011Bn")};deleteImageController.addEventListener("click",()=>(disableImageControllers(!0),profileImage.src.includes("/uploads/profiles/default.svg")?disableImageControllers(!1,"Nen\xED nahran\xFD \u017E\xE1dn\xFD obr\xE1zek"):void(fetch("/controllers/UserImageUpdate.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`mode=2`}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):deleteImage()}).catch(()=>console.error(`[!] An error occurred while processing the script.`)),disableImageControllers(!1)))),uploadImage.addEventListener("change",()=>{disableImageControllers(!0);let a=uploadImage.files[0];if(a==null)return disableImageControllers(!1,"B\u011Bhem nahr\xE1v\xE1n\xED souboru do\u0161lo k chyb\u011B");if(1086e3<=a.size)return disableImageControllers(!1,"Nahran\xFD soubor m\xE1 v\xEDce ne\u017E 1 MB");const b=new FormData;b.append("mode",1),b.append("img",a),fetch("/controllers/UserImageUpdate.php",{method:"POST",credentials:"same-origin",body:b}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):updateImage(a.img)}).catch(()=>console.error(`[!] Webov치 aplikace nedok치zala rozpoznat data.`)),disableImageControllers(!1)}),document.addEventListener("DOMContentLoaded",()=>{uploadImageController.addEventListener("click",()=>{uploadImage.click()});for(let b=0;b<a.length;b++)a[b].addEventListener("keyup",()=>{a[b].dataset.state=a[b].dataset.default!==a[b].value});currentPassword.addEventListener("keyup",passwordCheck),newPassword.addEventListener("keyup",passwordCheck),updateprofile.addEventListener("click",()=>{const a=document.querySelectorAll("[lookup][data-state=\"true\"]");let b={},c=null,d=null,e=!1;for(let f=0;f<a.length;f++)a[f].reportValidity()?("userMail"===a[f].id?!checkMail(a[f].value)&&(showError(emailMessage,!1),e=!0):"userTelephone"===a[f].id&&!checkPhone(a[f].value)&&(showError(phoneMessage,!1),e=!0),c=a[f].id,d=a[f].value,b[c]=d):e=!0;e?showToast("[!] Zm\u011Bny nebyly ulo\u017Eeny"):0===Object.keys(b).length&&b.constructor===Object?showToast("Nedo\u0161lo k \u017E\xE1dn\xE9 zm\u011Bn\u011B"):(b.userNewPassword!==void 0&&(b.userOldPassword=currentPassword.value),fetch("/controllers/UserProfileUpdate.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`data=${encodeURIComponent(JSON.stringify(b))}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):reloadProfile(a)}).catch(()=>console.error(`[!] Webov치 aplikace nedok치zala rozpoznat data.`)),console.log(b))})});