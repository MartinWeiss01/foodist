/* Minified (39.87%) © Copyright 2021 Martin Weiss (martinweiss.cz) */
let DEBUG_RANDOM_NUMBER=()=>3860+Math.floor(Math.random()*Math.floor(1111));const DEBUG=!1,citiesBox=document.getElementById("citiesBox"),cuisinesBox=document.getElementById("cuisinesBox"),overlayModalBox=document.getElementById("overlayModal"),modalContentHeader=document.getElementById("modalContentHeader"),modalContentBox=document.getElementById("modalContentBox"),modalConfirmInput=document.getElementById("modalConfirm"),modalCancelInput=document.getElementById("modalCancel");document.addEventListener("DOMContentLoaded",()=>{window.setTimeout(()=>DEBUG?showToast("[!] Webov\xE1 aplikace se nach\xE1z\xED v testovac\xEDm re\u017Eimu!"):"",860)}),document.addEventListener("keydown",a=>{overlayModalBox.classList.contains("active")&&("Escape"==a.key?hideModal():"Enter"==a.key&&modalConfirmInput.click())}),modalCancelInput.addEventListener("click",hideModal),modalConfirmInput.addEventListener("click",function(){if(1==overlayModalBox.dataset.mode){let a=overlayModalBox.dataset.obj,b=document.getElementById("insertRecordName").value,c=document.getElementById("cities").value,d=document.getElementById("insertRecordAddress").value,e=document.querySelectorAll("#checkboxesCuisines input"),f=[];for(let a=0;a<e.length;a++)e[a].checked&&f.push(parseInt(e[a].value));""!=b&&(DEBUG?appendNewRestaurant(a,DEBUG_RANDOM_NUMBER,b,d,c):fetch("../controllers/addNewRestaurant.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`city=${c}&account=${a}&name=${b}&address=${d}&cuisines=${f}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(e=>{e.error_code?console.warn(`[!] ${e.error_message} (code: ${e.error_code}) | ${e.mysql_error}`):appendNewRestaurant(a,e.insert_id,b,d,c)}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`)))}else if(2==overlayModalBox.dataset.mode){let a=[],b=[],c=!1,d=overlayModalBox.dataset.obj,e=document.getElementById("restaurantName");if(null!==document.getElementById("foodlist-editable")){let c=document.getElementById("foodlist-editable").childNodes;for(let d=0;d<c.length;d++)if(c[d].hasAttribute("delete"))b.push({ID:c[d].dataset.fid});else{let b=document.getElementById("foodName-"+c[d].dataset.fid),e=document.getElementById("foodPrice-"+c[d].dataset.fid);(b.hasAttribute("changed")||e.hasAttribute("changed"))&&a.push({ID:c[d].dataset.fid,Name:b.innerText,Price:e.innerText})}}e.hasAttribute("changed")&&(document.getElementById("company-restaurant-"+d).dataset.restaurantName=document.getElementById("restaurantName").innerText,document.getElementById("restaurant-nameblock-"+d).innerText=document.getElementById("restaurantName").innerText,c=!0);let f={restaurantName:e.innerText,nameChanged:c,food:a},g=JSON.stringify({update:f,toDelete:b});DEBUG?console.log(g):(0!==a.length||0!==b.length||c)&&fetch("../controllers/updateFoodlist.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`rid=${d}&data=${encodeURIComponent(g)}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code&&console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`)}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`))}else if(3==overlayModalBox.dataset.mode){let a=overlayModalBox.dataset.obj,b=document.getElementById("company-restaurant-"+a);DEBUG?removeRecordFromList(b):fetch("../controllers/removeRestaurant.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`rid=${a}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):removeRecordFromList(b)}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`))}else if(4==overlayModalBox.dataset.mode){let a=document.getElementById("insertAccountName").value,b=document.getElementById("insertAccountIN").value,c=document.getElementById("insertAccountEmail").value,d=document.getElementById("insertAccountPassword").value;""!=a&&""!=b&&""!=c&&""!=d&&(DEBUG?appendNewCompany(DEBUG_RANDOM_NUMBER,a,b,c):fetch("../controllers/addNewCompany.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`name=${a}&accountin=${b}&email=${c}&pwd=${d}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(d=>{d.error_code?console.warn(`[!] ${d.error_message} (code: ${d.error_code}) | ${d.mysql_error}`):appendNewCompany(d.insert_id,a,b,c)}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`)))}else if(5==overlayModalBox.dataset.mode){let a=document.getElementById("inserCuisineName").value,b=document.getElementById("insertCuisineImage").files[0];if(""!=a&&b!==void 0&&1086e3>b.size||b===void 0){const c=new FormData;c.append("name",a),c.append("image",b),fetch("../controllers/addCuisine.php",{method:"POST",credentials:"same-origin",body:c}).then(a=>a.ok?a.json():Promise.reject(a)).then(b=>{b.error_code?console.warn(`[!] ${b.error_message} (code: ${b.error_code}) | ${b.mysql_error}`):appendNewCuisine(b.insert_id,a,b.imagename)}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`))}}else if(6==overlayModalBox.dataset.mode){let a=document.getElementById("inserCityName").value,b=document.getElementById("insertCityImage").files[0];if(""!=a&&b!==void 0&&1086e3>b.size||b===void 0){const c=new FormData;c.append("name",a),c.append("image",b),fetch("../controllers/addCity.php",{method:"POST",credentials:"same-origin",body:c}).then(a=>a.ok?a.json():Promise.reject(a)).then(b=>{b.error_code?console.warn(`[!] ${b.error_message} (code: ${b.error_code}) | ${b.mysql_error}`):appendNewCity(b.insert_id,a,b.imagename)}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`))}}else if(7==overlayModalBox.dataset.mode){let a=overlayModalBox.dataset.obj,b=document.getElementById("company-"+a);DEBUG?removeRecordFromList(b,!0):fetch("../controllers/removeRestaurant.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`cid=${a}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):removeRecordFromList(b,!0)}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`))}hideModal()});function addNewCity(){showModal("P\u0159idat nov\xE9 m\u011Bsto","<input id=\"inserCityName\" placeholder=\"N\xE1zev m\u011Bsta\"><input id=\"insertCityImage\" type=\"file\" accept=\".jpeg, .jpg, .png, .webp, .avif\">",-1,"P\u0159idat",6)}function appendNewCity(a,b,c){c===void 0&&(c="default.min.jpg");let d=document.createElement("div");d.classList.add("flex","cardItem"),d.setAttribute("data-city-id",a),d.setAttribute("style",`background: url(/uploads/cities/${c}) no-repeat center center;background-size:cover;`),d.innerHTML=`<span class="cardTitle">${b}</span>`,document.getElementById("citiesBox").appendChild(d);let e=citiesList.slice(0,-9);e+=`<option value=${a}>${b}</option></select>`,citiesList=e}function addNewCuisine(){showModal("P\u0159idat novou kuchyni","<input id=\"inserCuisineName\" placeholder=\"N\xE1zev kuchyn\u011B\"><input id=\"insertCuisineImage\" type=\"file\" accept=\".jpeg, .jpg, .png, .webp, .avif\">",-1,"P\u0159idat",5)}function appendNewCuisine(a,b,c){c===void 0&&(c="default.min.jpg");let d=document.createElement("div");d.classList.add("flex","cardItem"),d.setAttribute("data-cuisine-id",a),d.setAttribute("style",`background: url(/uploads/cuisines/${c}) no-repeat center center;background-size:cover;`),d.innerHTML=`<span class="cardTitle">${b}</span>`,document.getElementById("cuisinesBox").appendChild(d);let e=cuisinesList.slice(0,-6);e+=`<input type="checkbox" name="cuisineOption${a}" value="${a}"><label for="cuisineOption${a}">${b}</label></div>`,cuisinesList=e}function addNewCompany(){showModal("P\u0159idat novou firmu","<input id=\"insertAccountName\" placeholder=\"N\xE1zev \xFA\u010Dtu\"><input id=\"insertAccountIN\" placeholder=\"I\u010CO spole\u010Dnosti\"><input id=\"insertAccountEmail\" placeholder=\"E-mailov\xE1 adresa\"><input type=\"password\" id=\"insertAccountPassword\" placeholder=\"Heslo\">",-1,"P\u0159idat",4)}function appendNewCompany(a,b,c,d){let e=document.createElement("div");e.classList.add("company"),e.setAttribute("id",`company-${a}`),e.setAttribute("data-company-id",a),e.setAttribute("data-company-name",b),e.setAttribute("data-company-in",c),e.setAttribute("data-company-mail",d),e.innerHTML=`<div class="flex row justify-content-between hcenter company-header table-record"><span class="companyheader">${b}</span><div class="companycontrollers"><icon data-tooltip="Přidat novou restauraci pro tuto společnost" class="material-icons add" onclick="addNewRestaurant(${a})">add_circle_outline</icon><icon class="material-icons edit" onclick="modalMode_Editing(${a}, true)">edit</icon><icon class="material-icons delete" onclick="removeRecord(${a}, true)">delete_outline</icon></div></div>`,document.getElementById("companiesList").appendChild(e)}function addNewRestaurant(a){let b="<input id=\"insertRecordName\" placeholder=\"N\xE1zev restaurace\"><input id=\"insertRecordAddress\" placeholder=\"Ulice\">";-1!=citiesList&&(b+=citiesList),-1!=cuisinesList&&(b+=cuisinesList),showModal("P\u0159idat restauraci",b,a,"P\u0159idat",1)}function appendNewRestaurant(a,b,c,d,e){let f=document.createElement("div");if(f.classList.add("flex","row","justify-content-between","hcenter","companysub","table-record"),f.setAttribute("id",`company-restaurant-${b}`),f.setAttribute("data-restaurant-id",b),f.setAttribute("data-restaurant-name",c),f.setAttribute("data-restaurant-address",d),f.setAttribute("data-restaurant-city",e),f.innerHTML=`<span id="restaurant-nameblock-${b}">${c}</span><div class="companycontrollers"><icon class="material-icons edit" onclick="modalMode_Editing(${b})">edit</icon><icon class="material-icons delete" onclick="removeRecord(${b})">delete_outline</icon></div>`,!document.getElementById("companyRestaurantsList-"+a)){let b=document.createElement("div");b.classList.add("companyRestaurantsList"),b.setAttribute("id",`companyRestaurantsList-${a}`),document.getElementById("company-"+a).appendChild(b),document.querySelector(`#company-${a} .companycontrollers`).innerHTML+=`<icon class="material-icons collapse" data-action="collapse" onclick="collapseElement(this, ${a})">expand_more</icon>`}document.getElementById("companyRestaurantsList-"+a).appendChild(f),document.getElementById("companyRestaurantsList-"+a).style.maxHeight=document.getElementById("companyRestaurantsList-"+a).scrollHeight+"px"}function removeRecord(a,b=!1){b?showModal("Smazat restauraci",document.getElementById("company-"+a).dataset.companyName,a,"Potvrdit",7):showModal("Smazat restauraci",document.getElementById("company-restaurant-"+a).dataset.restaurantName,a,"Potvrdit",3)}function removeRecordFromList(a,b=!1){if(!b&&1===a.parentElement.childElementCount){let b=a.parentElement.parentElement.dataset.companyId;return document.querySelector(`#company-${b} .companycontrollers icon[data-action="collapse"]`).remove(),void a.parentElement.remove()}a.remove()}function showModal(a,b,c,d,e){modalContentHeader.innerHTML=a,modalContentBox.innerHTML=b,modalConfirmInput.innerText=d,overlayModalBox.setAttribute("data-obj",c),overlayModalBox.setAttribute("data-mode",e),overlayModalBox.classList.add("active"),document.getElementById("root").setAttribute("modon","")}function hideModal(){modalContentBox.innerHTML="",modalConfirmInput.innerHTML="",overlayModalBox.removeAttribute("data-obj"),overlayModalBox.removeAttribute("data-mode"),overlayModalBox.classList.remove("active"),document.getElementById("root").removeAttribute("modon")}function collapseElement(a,b){let c=document.getElementById("companyRestaurantsList-"+b);a.classList.toggle("active"),null===c.getAttribute("collapsed")?(c.setAttribute("collapsed",""),c.style.maxHeight=c.scrollHeight+"px",c.style.removeProperty("overflow")):(c.removeAttribute("collapsed"),c.style.maxHeight=null,c.style.overflow="hidden")}function modalMode_Editing(a,b=!1){b?showToast("Not implemented yet"):fetch("../controllers/getFoodList.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`rid=${a}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(b=>{if(b.error_code)console.warn(`[!] ${b.error_message} (code: ${b.error_code}) | ${b.mysql_error}`);else{let c=document.getElementById("company-restaurant-"+a).dataset.restaurantName,d=`<span id="restaurantName" data-default="${c}" contenteditable="true" oninput="foodrecordChanging(this)">${c}</span>`;if(!b.emptylist){let a="<div id=\"foodlist-editable\" class=\"foodlist\">";for(let c=0;c<b.length;c++)a+=`<div id="foodID-${b[c][0]}" data-fid="${b[c][0]}" class="flex row hcenter justify-content-between food-record"><div class="flex"><span id="foodName-${b[c][0]}" data-default="${b[c][1]}" class="foodName" contenteditable="true" oninput="foodrecordChanging(this)">${b[c][1]}</span><div class="foodPriceRow"><span id="foodPrice-${b[c][0]}" data-default="${b[c][2]}" class="foodPrice" contenteditable="true" oninput="foodrecordChanging(this)">${b[c][2]}</span><span> Kč</span></div></div><div class="flex row"><icon class="restore" onclick="modalMode_Editing_Restore(this)">restore</icon><icon class="delete" onclick="modalMode_Editing_Delete(this)">delete_outline</icon></div></div>`;a+="</div>",d+=a}showModal("\xDAprava restaurace",d,a,"Ulo\u017Eit",2)}}).catch(()=>{console.log(`[!] Při komunikaci se serverem došlo k chybě.`)})}function foodrecordChanging(a){a.dataset.default==a.innerText?a.removeAttribute("changed"):a.setAttribute("changed","")}function modalMode_Editing_Restore(a){let b=a.parentElement.parentElement,c=b.dataset.fid;document.getElementById("foodName-"+c).innerText=document.getElementById("foodName-"+c).dataset.default,document.getElementById("foodPrice-"+c).innerText=document.getElementById("foodPrice-"+c).dataset.default,b.childNodes[1].childNodes[1].removeAttribute("changed")}function modalMode_Editing_Delete(a){a.hasAttribute("changed")?(a.parentElement.parentElement.removeAttribute("delete"),a.removeAttribute("changed")):(a.parentElement.parentElement.setAttribute("delete",""),a.setAttribute("changed",""))}