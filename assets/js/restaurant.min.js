const restController=document.getElementsByClassName("restaurant-controller"),restContent=document.getElementById("restaurant-content"),vals={1:5,2:4,3:3,4:2,5:1},cartContainer=document.getElementById("containerCart"),mainContainer=document.getElementById("root"),orderButton=document.getElementById("orderButton"),totalPrice=document.getElementById("totalPrice"),displayContent=a=>{let b=-1;for(let c=0;c<restContent.children.length;c++)restContent.children[c].id===a?b=c:restContent.children[c].classList.remove("active");-1!==b&&restContent.children[b].classList.add("active")},loadExternalContent=(a,b)=>{if(document.getElementById(a).removeAttribute("ready"),"reviews"===a){let c="",d=!1,e=0,f="",g=0,h="",i="<h1>Recenze</h1>";if(1>b.total)i+=`<div class="flex hcenter collapsed-content">Zatím nemáme žádnou recenzi!</div>`;else for(let a=0;a<b.reviews.length;a++)userID===b.reviews[a].UID?(d=!0,e=b.reviews[a].ID,g=b.reviews[a].Stars,f=b.reviews[a].Comment):c+=`<div class="flex review"><div class="flex row hcenter justify-content-between"><div class="flex row hcenter profile-details"><img class="review-profile" src="/uploads/profiles/${b.reviews[a].Image}"><div class="flex vcenter"><span class="review-user">${b.reviews[a].Name}</span><span class="review-date">${b.reviews[a].Date}</span></div></div><div class="flex row hcenter vcenter wrap"><span class="review-val">${b.reviews[a].Stars}</span><svg width="19px" fill="url(#a)" viewBox="0 0 50 50"><linearGradient id="a" gradientUnits="userSpaceOnUse" x1="-.1913" y1="55.1364" x2="28.8917" y2="16.2304" gradientTransform="matrix(1.0417 0 0 -1.0417 9.5833 63.75)"><stop offset="0" stop-color="#ffda1c"></stop><stop offset="1" stop-color="#feb705"></stop></linearGradient><path d="M26 5.1l5.7 12.8 13.9 1.5c.9.1 1.3 1.2.6 1.8l-10.4 9.4 2.9 13.7c.2.9-.8 1.6-1.5 1.1l-12.1-7-12.1 7c-.8.4-1.7-.2-1.5-1.1l2.9-13.7-10.6-9.4c-.7-.6-.3-1.7.6-1.8l13.9-1.5L24 5.1c.4-.8 1.6-.8 2 0z"></path></svg></div></div>${b.reviews[a].Comment?`<p class="comment">${b.reviews[a].Comment}</p>`:``}</div>`;h=`<div class="flex editable-review"><label for="urcomment">Tvoje recenze</label><textarea id="urcomment" name="urcomment" class="ta-comment">${f}</textarea><div class="flex row vcenter" data-stars="${g}" style="direction:rtl"><svg id="s1" class="ta-star" viewBox="0 0 50 50" data-role="button" onclick="changeStars(1)"><linearGradient id="a" gradientUnits="userSpaceOnUse" x1="-.1913" y1="55.1364" x2="28.8917" y2="16.2304" gradientTransform="matrix(1.0417 0 0 -1.0417 9.5833 63.75)"><stop offset="0" stop-color="#ffda1c"></stop><stop offset="1" stop-color="#feb705"></stop></linearGradient><path d="M26 5.1l5.7 12.8 13.9 1.5c.9.1 1.3 1.2.6 1.8l-10.4 9.4 2.9 13.7c.2.9-.8 1.6-1.5 1.1l-12.1-7-12.1 7c-.8.4-1.7-.2-1.5-1.1l2.9-13.7-10.6-9.4c-.7-.6-.3-1.7.6-1.8l13.9-1.5L24 5.1c.4-.8 1.6-.8 2 0z"></path></svg><svg id="s2" class="ta-star" viewBox="0 0 50 50" data-role="button" onclick="changeStars(2)"><path d="M26 5.1l5.7 12.8 13.9 1.5c.9.1 1.3 1.2.6 1.8l-10.4 9.4 2.9 13.7c.2.9-.8 1.6-1.5 1.1l-12.1-7-12.1 7c-.8.4-1.7-.2-1.5-1.1l2.9-13.7-10.6-9.4c-.7-.6-.3-1.7.6-1.8l13.9-1.5L24 5.1c.4-.8 1.6-.8 2 0z"></path></svg><svg id="s3" class="ta-star" viewBox="0 0 50 50" data-role="button" onclick="changeStars(3)"><path d="M26 5.1l5.7 12.8 13.9 1.5c.9.1 1.3 1.2.6 1.8l-10.4 9.4 2.9 13.7c.2.9-.8 1.6-1.5 1.1l-12.1-7-12.1 7c-.8.4-1.7-.2-1.5-1.1l2.9-13.7-10.6-9.4c-.7-.6-.3-1.7.6-1.8l13.9-1.5L24 5.1c.4-.8 1.6-.8 2 0z"></path></svg><svg id="s4" class="ta-star" viewBox="0 0 50 50" data-role="button" onclick="changeStars(4)"><path d="M26 5.1l5.7 12.8 13.9 1.5c.9.1 1.3 1.2.6 1.8l-10.4 9.4 2.9 13.7c.2.9-.8 1.6-1.5 1.1l-12.1-7-12.1 7c-.8.4-1.7-.2-1.5-1.1l2.9-13.7-10.6-9.4c-.7-.6-.3-1.7.6-1.8l13.9-1.5L24 5.1c.4-.8 1.6-.8 2 0z"></path></svg><svg id="s5" class="ta-star" viewBox="0 0 50 50" data-role="button" onclick="changeStars(5)"><path d="M26 5.1l5.7 12.8 13.9 1.5c.9.1 1.3 1.2.6 1.8l-10.4 9.4 2.9 13.7c.2.9-.8 1.6-1.5 1.1l-12.1-7-12.1 7c-.8.4-1.7-.2-1.5-1.1l2.9-13.7-10.6-9.4c-.7-.6-.3-1.7.6-1.8l13.9-1.5L24 5.1c.4-.8 1.6-.8 2 0z"></path></svg></div><div class="flex row grow vcenter comment-controllers"><button id="updatecomment" class="comment-controller save" data-role="button" data-pid="${e}" onclick="updateReview(this, 1)">Uložit recenzi</button><button id="deletecomment" class="comment-controller decline" data-role="button" data-pid="${e}" onclick="updateReview(this, 2)" ${d?"":"disabled"}>Smazat</button></div></div>`,document.getElementById(a).innerHTML=`${i}<div class="flex hcenter collapsed-content">${auth?h:""}${c}</div>`,d&&document.querySelector(`#s${vals[g]}`).classList.add("active")}};function changeStars(a){null!==document.querySelector(".ta-star.active")&&document.querySelector(".ta-star.active").classList.remove("active"),document.querySelector("[data-stars]").dataset.stars=vals[a],document.querySelector(`#s${a}`).classList.add("active")}const clearReview=()=>{document.querySelector("[data-stars]").dataset.stars=0,document.getElementById("urcomment").value="",document.getElementById("deletecomment").setAttribute("disabled",""),showToast("Recenze odebr\xE1na")};function updateReview(a,b){if(1===b){let b=document.querySelector("[data-stars]").dataset.stars,c=document.getElementById("urcomment").value;fetch("/controllers/RestaurantReviewUpdateAPI.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`restid=${restaurantID}&reviewid=${a.dataset.pid}&uid=${userID}&type=1&stars=${b}&comment=${encodeURIComponent(c)}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(b=>{b.error_code?console.warn(`[!] ${b.error_message} (code: ${b.error_code}) | ${b.mysql_error}`):0==a.dataset.pid?(document.getElementById("updatecomment").dataset.pid=b.reviewid,document.getElementById("deletecomment").dataset.pid=b.reviewid,document.getElementById("deletecomment").removeAttribute("disabled"),showToast("Recenze p\u0159id\xE1na")):showToast("Recenze aktualizov\xE1na")}).catch(()=>console.error(`[!] An error occurred while processing the script.`))}else 2===b&&0!=a.dataset.pid&&fetch("/controllers/RestaurantReviewUpdateAPI.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`restid=${restaurantID}&reviewid=${a.dataset.pid}&uid=${userID}&type=2`}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):clearReview()}).catch(()=>console.error(`[!] An error occurred while processing the script.`))}function getExternalContent(a){let b=a.dataset.content;document.getElementById(b).hasAttribute("ready")&&"reviews"===b&&fetch("/controllers/RestaurantReviewsAPI.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`rid=${restaurantID}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):loadExternalContent(b,a)}).catch(()=>console.error(`[!] An error occurred while processing the script.`))}document.addEventListener("DOMContentLoaded",()=>{checkCart();for(let a=0;a<restController.length;a++)restController[a].addEventListener("click",()=>{for(let a=0;a<restController.length;a++)restController[a].classList.remove("active");displayContent(restController[a].dataset.content),restController[a].classList.add("active")})}),orderButton.addEventListener("click",()=>{orderButton.hasAttribute("disabled")||fetch("/controllers/placeOrder.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):finishOrder()}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`))});function addToCart(a){actionCart(1,`&fid=${a}`)}function checkCart(){actionCart(2)}function updateCart(a,b){actionCart(3,`&fid=${a}&count=${b}`)}function finishOrder(){checkCart(),showToast("Objedn\xE1vka byla \xFAsp\u011B\u0161n\u011B odesl\xE1na")}function actionCart(a,b=""){fetch("/controllers/cart.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`action=${a}${b}`}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{a.error_code?console.warn(`[!] ${a.error_message} (code: ${a.error_code}) | ${a.mysql_error}`):parseCart(a)}).catch(()=>console.error(`[!] Webová aplikace nedokázala rozpoznat data.`))}function parseCart(a){if(cartContainer.innerHTML=null,totalPriceInt=0,0!=Object.keys(a).length){let b="";for(let c=0;c<Object.keys(a).length;c++)b+=`<div class="flex row hcenter justify-content-between cartItem" data-fid="${a[Object.keys(a)[c]][0]}" data-fcount="${a[Object.keys(a)[c]][1]}" data-fprice="${a[Object.keys(a)[c]][2]}"><div class="flex"><span class="cartItemName">${a[Object.keys(a)[c]][3]}</span><span class="cartItemPrice">${(a[Object.keys(a)[c]][2]*a[Object.keys(a)[c]][1]).toFixed(2)} Kč</span></div><div class="flex row hcenter"><icon class="remove" data-role="button" onclick="itemCountChange(this, 0)">remove</icon><span style="padding:0 10px;" class="cartItemCount">${a[Object.keys(a)[c]][1]}</span><icon class="add" data-role="button" onclick="itemCountChange(this, 1)">add</icon></div></div>`;totalPriceInt=Object.keys(a).map(b=>a[b]).reduce((b,c)=>b+c[1]*c[2],0),cartContainer.innerHTML=b,orderButton.removeAttribute("disabled")}else cartContainer.innerHTML=`<span style="text-align:center">Váš nákupní košík je prázdný</span>`,orderButton.setAttribute("disabled","");totalPrice.innerText=`${totalPriceInt} Kč`}function itemCountChange(a,b=0){let c=a.parentElement.parentElement;if(0==b)c.dataset.fcount--;else if(15>c.dataset.fcount)c.dataset.fcount++;else return;updateCart(c.dataset.fid,c.dataset.fcount)}