const restController = document.getElementsByClassName('restaurant-controller'),
        restContent = document.getElementById('restaurant-content');

const displayContent = (content) => {
    let contentid = -1;
    for(let i = 0; i < restContent.children.length; i++) {
        if(restContent.children[i].id !== content) restContent.children[i].classList.remove('active');
        else contentid = i;
    }

    if(contentid !== -1) {
        restContent.children[contentid].classList.add('active');
    }
};


/*
    <h1>Recenze</h1>
    <div class="flex hcenter">
        <div class="flex review">
            <div class="flex row hcenter justify-content-between">
                <div class="flex row hcenter">
                    <img height="50px" width="50px">
                    <div class="flex vcenter">
                        <span>Uživatel</span>
                        <span>2021-04-01 16:13:12</span>
                    </div>
                </div>
                <span>5 hvězdiček</span>
            </div>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Impedit nisi temporibus nemo maxime explicabo possimus neque itaque molestias dolores. Culpa ipsum quibusdam facilis sapiente quasi tempora dolor consectetur animi saepe!</p>
        </div>

    </div>


<svg fill="url(#col)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="active"><path d="M26 5.1l5.7 12.8 13.9 1.5c.9.1 1.3 1.2.6 1.8l-10.4 9.4 2.9 13.7c.2.9-.8 1.6-1.5 1.1l-12.1-7-12.1 7c-.8.4-1.7-.2-1.5-1.1l2.9-13.7-10.6-9.4c-.7-.6-.3-1.7.6-1.8l13.9-1.5L24 5.1c.4-.8 1.6-.8 2 0z"></path></svg>
*/

const loadExternalContent = (element, data) => {
    document.getElementById(element).removeAttribute('ready');
    if(element === 'reviews') {
        let content = "";
        if(data.total < 1) content = `Zatím nemáme žádnou recenzi!`;
        else {
            for(let i = 0; i < data.reviews.length; i++) {
                content += `<div class="flex review">
                    <div class="flex row hcenter justify-content-between">
                        <div class="flex row hcenter profile-details">
                            <img class="review-profile" src="/uploads/profiles/${data.reviews[i].Image}">
                            <div class="flex vcenter">
                                <span class="review-user">${data.reviews[i].Name}</span>
                                <span class="review-date">${data.reviews[i].Date}</span>
                            </div>
                        </div>
                        <div class="flex row hcenter vcenter wrap"><span class="review-val">${data.reviews[i].Stars}</span><svg width="19px" fill="url(#a)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><linearGradient id="a" gradientUnits="userSpaceOnUse" x1="-.1913" y1="55.1364" x2="28.8917" y2="16.2304" gradientTransform="matrix(1.0417 0 0 -1.0417 9.5833 63.75)"><stop offset="0" stop-color="#ffda1c"></stop><stop offset="1" stop-color="#feb705"></stop></linearGradient><path d="M26 5.1l5.7 12.8 13.9 1.5c.9.1 1.3 1.2.6 1.8l-10.4 9.4 2.9 13.7c.2.9-.8 1.6-1.5 1.1l-12.1-7-12.1 7c-.8.4-1.7-.2-1.5-1.1l2.9-13.7-10.6-9.4c-.7-.6-.3-1.7.6-1.8l13.9-1.5L24 5.1c.4-.8 1.6-.8 2 0z"></path></svg></div>
                    </div>
                    ${data.reviews[i].Comment ? `<p class="comment">${data.reviews[i].Comment}</p>` : ``}
                </div>`;
            }
        }
        document.getElementById(element).innerHTML = `<h1>Recenze</h1><div class="flex hcenter collapsed-content">${content}</div>`;
    } else {
        document.getElementById(element).innerText = data;
        console.log(`Added ${element} - ${data}`);
        console.info(data);
    }
};

function getExternalContent(element) {
    let content = element.dataset.content;
    if(document.getElementById(content).hasAttribute('ready')) {
        if(content === 'reviews') {
            fetch('/controllers/RestaurantReviewsAPI.php', {method: 'POST', credentials: 'same-origin', headers: {'Content-Type': 'application/x-www-form-urlencoded'}, body: `rid=${restaurantID}`})
            .then(response => {
              if(response.ok) return response.json();
              return Promise.reject(response);
            })
            .then(data => {data['error_code'] ? console.warn(`[!] ${data["error_message"]} (code: ${data["error_code"]}) | ${data["mysql_error"]}`) : loadExternalContent(content, data);})
            .catch(err => console.error(`[!] An error occurred while processing the script.`));
        }
    }
};

document.addEventListener('DOMContentLoaded', () => {
    for(let i = 0; i < restController.length; i++) {
        restController[i].addEventListener('click', (e) => {
            for(let j = 0; j < restController.length; j++) restController[j].classList.remove('active');
            displayContent(restController[i].dataset.content);
            restController[i].classList.add('active');
        });
    }
});