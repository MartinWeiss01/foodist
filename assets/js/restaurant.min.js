const restController = document.getElementsByClassName('restaurant-controller'),
        restContent = document.getElementById('restaurant-content');

const displayContent = (content) => {
    let contentid = -1;
    for(let i = 0; i < restContent.children.length; i++) {
        if(restContent.children[i].id !== content) restContent.children[i].classList.remove('active');
        else contentid = i;
    }

    if(contentid !== -1) {
        restContent.children[contentid].classList.add('active');
    }
};

const loadExternalContent = (element, data) => {
    document.getElementById(element).removeAttribute('ready');
    document.getElementById(element).innerText = data;
    console.log(`Added ${element} - ${data}`);
    console.info(data);
};

function getExternalContent(element) {
    let content = element.dataset.content;
    if(document.getElementById(content).hasAttribute('ready')) {
        if(content === 'reviews') {
            fetch('/controllers/RestaurantReviewsAPI.php', {method: 'POST', credentials: 'same-origin', headers: {'Content-Type': 'application/x-www-form-urlencoded'}, body: `rid=${restaurantID}`})
            .then(response => {
              if(response.ok) return response.json();
              return Promise.reject(response);
            })
            .then(data => {data['error_code'] ? console.warn(`[!] ${data["error_message"]} (code: ${data["error_code"]}) | ${data["mysql_error"]}`) : loadExternalContent(content, data);})
            .catch(err => console.error(`[!] An error occurred while processing the script.`));
        }
    }
};

document.addEventListener('DOMContentLoaded', () => {
    for(let i = 0; i < restController.length; i++) {
        restController[i].addEventListener('click', (e) => {
            for(let j = 0; j < restController.length; j++) restController[j].classList.remove('active');
            displayContent(restController[i].dataset.content);
            restController[i].classList.add('active');
        });
    }
});